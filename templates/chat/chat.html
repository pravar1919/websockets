{% extends "base.html" %}
{% block content %}

<h4>Group Name:{{name}}</h4>
<textarea id="chat_logs" rows="20" cols="50"></textarea
><br />
<input type="text" id="chat_input" /><br /><br />
<button type="submit" id="chat_submit" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2">Submit</button>

<script>
    let submit = document.getElementById("chat_submit");
    let msg = document.getElementById("chat_input");
    let msgLogs = document.getElementById("chat_logs");

    // const chatWs = new WebSocket("ws://localhost:8000/ws/as/chat/{{name}}/")
    const chatWs = new WebSocket("ws://" +  window.location.host + "/chat/ws/as/" + "{{name}}/")
    chatWs.onopen = function (e) {
        console.log("The chat connection was setup successfully !", e);
        // chatWs.send(JSON.stringify({user_id : "{{request.user.id}}", "status":"online"}));
    };
    window.addEventListener('beforeunload', function () {
        // chatWs.send(JSON.stringify({user_id : "{{request.user.id}}", "status":"offline"}));
    });
    chatWs.onclose = function (e) {
        console.log("Something unexpected happened !", e);
    };
    chatWs.onmessage = function (e) {
        // const data = JSON.parse(e.data);
        console.log(e);
        parsedData = JSON.parse(e.data);
        console.log(parsedData);
        msgLogs.append(parsedData.user + " : " + parsedData.msg + "\n");
    };
    submit.addEventListener("click", function (e) {
        console.log(JSON.stringify(msg.value));
        chatWs.send(
            JSON.stringify({
                msg: msg.value,
                user: "{{request.user.username}}",
            })
        );
        msg.value = "";
    });
</script>
{% endblock %}